<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="com.dc.comments">
	<resultMap type="com.dc.comments.vo.CommentVo"
		id="commentsResultMap">
		<id column="COMMENT_NO" property="commentNo" />
		<result column="BOARD_NO" property="boardNo" />
		<result column="MEMBER_NO" property="memberNo" />
		<result column="CONTENTS" property="contents" />
		<result column="CRE_DATE" property="createDate"
			javaType="java.util.Date" />
		<result column="MOD_DATE" property="modifiedDate"
			javaType="java.util.Date" /> 
	</resultMap>

	
	
	<select id="commentSelectList" parameterType="map"
		resultMap="commentsResultMap">
		SELECT ROWNUM, COMMENT_NO, BOARD_NO, MEMBER_NO, NICKNAME, CONTENTS, CRE_DATE, MOD_DATE
		FROM
		(
		    SELECT C.COMMENT_NO AS COMMENT_NO, C.BOARD_NO AS BOARD_NO, C.MEMBER_NO AS MEMBER_NO
		        , M.NICKNAME AS NICKNAME, C.CONTENTS AS CONTENTS, C.CRE_DATE AS CRE_DATE, C.MOD_DATE AS MOD_DATE
		    FROM COMMENTS C, BOARD B, MEMBERS M
		    WHERE C.BOARD_NO = B.BOARD_NO
		    AND M.MEMBER_NO = C.MEMBER_NO
		    AND B.BOARD_NO = #{boardNo}
		    ORDER BY C.COMMENT_NO DESC
		)
	</select>
	
	
	

	<select id="commentSelectOne" parameterType="int"
		resultMap="commentsResultMap">
		SELECT B.BOARD_NO, B.TITLE, B.CONTENTS, B.MEMBER_NO, M.NICKNAME, B.CRE_DATE, B.MOD_DATE
		FROM BOARD B, MEMBERS M
		WHERE B.MEMBER_NO = M.MEMBER_NO
		AND B.BOARD_NO = #{boardNo}
	</select>
	
	<insert id="commentInsertOne" 
		parameterType= "boardVo"
		useGeneratedKeys="true" keyProperty="boardNo">
		<selectKey keyProperty="boardNo" resultType="int" order="BEFORE">
			SELECT BOARD_NO_SEQ.NEXTVAL FROM DUAL
		</selectKey>
		
		INSERT INTO BOARD
		(BOARD_NO, MEMBER_NO, TITLE, CONTENTS, CRE_DATE, MOD_DATE)
		VALUES(#{boardNo}, #{memberNo}, #{title}, #{contents}, SYSDATE, SYSDATE)
	</insert>
	

	
	<update id="commentUpdateOne" parameterType="boardVo">
		UPDATE 	BOARD
		<set>
			<if test="title != ''">TITLE = #{title},</if>
			<if test="contents != ''">CONTENTS = #{contents},</if>
			MOD_DATE = SYSDATE			
		</set>
		WHERE 	 BOARD_NO = #{boardNo}
	</update>


 	<delete id="commentDelete" parameterType="int"> 
		DELETE FROM BOARD
		WHERE BOARD_NO = #{boardNo}
	</delete>
	

	
	<select id="commentSelectTotalCount" parameterType="int"
		resultType="int">
		SELECT ROWNUM, COMMENT_NO, BOARD_NO, MEMBER_NO, NICKNAME, CONTENTS, CRE_DATE, MOD_DATE
		FROM
		(
		    SELECT C.COMMENT_NO AS COMMENT_NO, C.BOARD_NO AS BOARD_NO, C.MEMBER_NO AS MEMBER_NO
		        , M.NICKNAME AS NICKNAME, C.CONTENTS AS CONTENTS, C.CRE_DATE AS CRE_DATE, C.MOD_DATE AS MOD_DATE
		    FROM COMMENTS C, BOARD B, MEMBERS M
		    WHERE C.BOARD_NO = B.BOARD_NO
		    AND M.MEMBER_NO = C.MEMBER_NO
		    AND B.BOARD_NO = #{boardNo}
		    ORDER BY C.COMMENT_NO DESC
		)
	</select>
	
	
	
	
	
</mapper>